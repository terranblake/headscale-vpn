[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:tailscaled]
command=/usr/local/bin/tailscaled --tun=userspace-networking --state=/var/lib/tailscale/tailscaled.state --socket=/var/run/tailscale/tailscaled.sock
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/tailscaled.err.log
stdout_logfile=/var/log/tailscaled.out.log
environment=PATH="/usr/local/bin:/usr/bin:/bin"

[program:tailscale-auth]
command=/usr/local/bin/setup-tailscale.sh
user=root
autostart=true
autorestart=false
startretries=5
stderr_logfile=/var/log/tailscale-auth.err.log
stdout_logfile=/var/log/tailscale-auth.out.log
depends_on=tailscaled

[program:nordvpn]
command=/usr/local/bin/start-nordvpn.sh
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/nordvpn.err.log
stdout_logfile=/var/log/nordvpn.out.log
depends_on=tailscale-auth

[program:routing-manager]
command=/usr/local/bin/manage-routing.sh
user=root
autostart=true
autorestart=true
stderr_logfile=/var/log/routing.err.log
stdout_logfile=/var/log/routing.out.log
depends_on=nordvpn
